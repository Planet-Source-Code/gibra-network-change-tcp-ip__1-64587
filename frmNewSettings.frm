VERSION 5.00
Begin VB.Form frmNewSettings 
   BorderStyle     =   3  'Fixed Dialog
   Caption         =   "Crea un nuovo profilo"
   ClientHeight    =   5175
   ClientLeft      =   45
   ClientTop       =   435
   ClientWidth     =   6000
   Icon            =   "frmNewSettings.frx":0000
   LinkTopic       =   "Form1"
   LockControls    =   -1  'True
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   5175
   ScaleWidth      =   6000
   ShowInTaskbar   =   0   'False
   StartUpPosition =   2  'CenterScreen
   Begin VB.PictureBox Picture1 
      Appearance      =   0  'Flat
      AutoRedraw      =   -1  'True
      BackColor       =   &H80000005&
      BorderStyle     =   0  'None
      ForeColor       =   &H80000008&
      Height          =   3345
      Left            =   240
      Picture         =   "frmNewSettings.frx":1982
      ScaleHeight     =   3345
      ScaleWidth      =   5535
      TabIndex        =   25
      TabStop         =   0   'False
      Top             =   1140
      Width           =   5535
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   0
         Left            =   2970
         MaxLength       =   3
         TabIndex        =   1
         Text            =   "255"
         Top             =   450
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   1
         Left            =   3420
         MaxLength       =   3
         TabIndex        =   2
         Text            =   "255"
         Top             =   450
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   2
         Left            =   3870
         MaxLength       =   3
         TabIndex        =   3
         Text            =   "255"
         Top             =   450
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   3
         Left            =   4320
         MaxLength       =   3
         TabIndex        =   4
         Text            =   "255"
         Top             =   450
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   4
         Left            =   2970
         MaxLength       =   3
         TabIndex        =   5
         Text            =   "255"
         Top             =   840
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   5
         Left            =   3420
         MaxLength       =   3
         TabIndex        =   6
         Text            =   "255"
         Top             =   840
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   6
         Left            =   3870
         MaxLength       =   3
         TabIndex        =   7
         Text            =   "255"
         Top             =   840
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   7
         Left            =   4320
         MaxLength       =   3
         TabIndex        =   8
         Text            =   "255"
         Top             =   840
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   8
         Left            =   2970
         MaxLength       =   3
         TabIndex        =   9
         Text            =   "255"
         Top             =   1230
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   9
         Left            =   3420
         MaxLength       =   3
         TabIndex        =   10
         Text            =   "255"
         Top             =   1230
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   10
         Left            =   3870
         MaxLength       =   3
         TabIndex        =   11
         Text            =   "255"
         Top             =   1230
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   11
         Left            =   4320
         MaxLength       =   3
         TabIndex        =   12
         Text            =   "255"
         Top             =   1230
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   12
         Left            =   2970
         MaxLength       =   3
         TabIndex        =   13
         Text            =   "255"
         Top             =   2475
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   13
         Left            =   3420
         MaxLength       =   3
         TabIndex        =   14
         Text            =   "255"
         Top             =   2475
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   14
         Left            =   3870
         MaxLength       =   3
         TabIndex        =   15
         Text            =   "255"
         Top             =   2475
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   15
         Left            =   4320
         MaxLength       =   3
         TabIndex        =   16
         Text            =   "255"
         Top             =   2475
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   16
         Left            =   2970
         MaxLength       =   3
         TabIndex        =   17
         Text            =   "255"
         Top             =   2865
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   17
         Left            =   3420
         MaxLength       =   3
         TabIndex        =   18
         Text            =   "255"
         Top             =   2865
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   18
         Left            =   3870
         MaxLength       =   3
         TabIndex        =   19
         Text            =   "255"
         Top             =   2865
         Width           =   375
      End
      Begin VB.TextBox txtIP 
         Appearance      =   0  'Flat
         BorderStyle     =   0  'None
         Height          =   270
         Index           =   19
         Left            =   4320
         MaxLength       =   3
         TabIndex        =   20
         Text            =   "255"
         Top             =   2865
         Width           =   375
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   0
         Left            =   195
         TabIndex        =   32
         Top             =   105
         Width           =   720
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   1
         Left            =   570
         TabIndex        =   31
         Top             =   465
         Width           =   720
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   2
         Left            =   570
         TabIndex        =   30
         Top             =   855
         Width           =   720
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   3
         Left            =   570
         TabIndex        =   29
         Top             =   1245
         Width           =   720
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   4
         Left            =   195
         TabIndex        =   28
         Top             =   2130
         Width           =   720
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   5
         Left            =   570
         TabIndex        =   27
         Top             =   2490
         Width           =   720
      End
      Begin VB.Label lblAddress 
         AutoSize        =   -1  'True
         BackStyle       =   0  'Transparent
         Caption         =   "lblAddress"
         Height          =   195
         Index           =   6
         Left            =   570
         TabIndex        =   26
         Top             =   2880
         Width           =   720
      End
   End
   Begin VB.CommandButton cmdCancel 
      Cancel          =   -1  'True
      Caption         =   "Chiudi"
      Height          =   345
      Left            =   4455
      TabIndex        =   22
      Top             =   4695
      Width           =   1245
   End
   Begin VB.CommandButton cmdSave 
      Caption         =   "Salva"
      Height          =   345
      Left            =   3090
      TabIndex        =   21
      Top             =   4695
      Width           =   1245
   End
   Begin VB.TextBox txtProfileName 
      Height          =   285
      Left            =   240
      TabIndex        =   0
      Text            =   "txtProfileName"
      Top             =   375
      Width           =   4020
   End
   Begin VB.Label Label2 
      AutoSize        =   -1  'True
      BackStyle       =   0  'Transparent
      Caption         =   "Inserisci un valore e premi Invio (o il punto) per passare al campo successivo:"
      ForeColor       =   &H00C00000&
      Height          =   195
      Left            =   240
      TabIndex        =   24
      Top             =   855
      Width           =   5445
   End
   Begin VB.Image Image1 
      Height          =   480
      Left            =   5220
      Picture         =   "frmNewSettings.frx":161D0
      Top             =   225
      Width           =   480
   End
   Begin VB.Label Label1 
      AutoSize        =   -1  'True
      Caption         =   "Nome da assegnare a questo profilo:"
      Height          =   195
      Left            =   240
      TabIndex        =   23
      Top             =   150
      Width           =   2595
   End
End
Attribute VB_Name = "frmNewSettings"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
'---------------------------------------------------------------------------------------
' Module      : frmNewSettings
' DateTime    : 14/06/2005 10.00
' Author      : Giorgio Brausi (vbcorner@vbcorner.net - http://www.vbcorner.net)
' Project     : Network_Change
' Purpose     :
' Descritpion :
' Comments    :
' Modificato  : 20-06-2005 da: Doretto Roberto (roberto.doretto@volvo.com)
'               aggiunto la compilazione automatica del Subnet Mask
'               vedere l'evento txtIP_LostFocus()
'---------------------------------------------------------------------------------------
Option Explicit

'---------------------------------------------------------------------------------------
' Procedure   : AzzeraCampi
' DateTime    : 14/06/2005 13.50
' Author      : Giorgio Brausi (vbcorner@vbcorner.net - http://www.vbcorner.net)
' Purpose     : Azzera i TextBox all'apertura del form
' Descritpion :
' Comments    :
'---------------------------------------------------------------------------------------
Public Sub AzzeraCampi()
  Dim ctl As TextBox
  For Each ctl In Me.txtIP
    ctl.Text = ""
  Next
  txtProfileName.Text = ""
End Sub

Private Sub cmdCancel_Click()
  Unload Me
End Sub

Private Sub cmdSave_Click()

  If VerificaCampi <> -1 Then
    MsgBox MLSGetString("0022") ' MLS-> "Mancano uno o più valori."
    If VerificaCampi = -2 Then
      txtProfileName.SetFocus
    Else
      txtIP(VerificaCampi).SetFocus
    End If
    Exit Sub
  End If
  
  ProfileSave CIni.FileName, txtProfileName.Text, txtIP
  
  Rem Azzero e ricarico la lista, così mostro il nuovo
  Rem profilo appena aggiunto
  ProfilesLoad CIni.FileName, frmMain.lstProfiles
  
End Sub


Private Sub Form_Activate()
  Dim lButtonFaceColor As Long
  lButtonFaceColor = GetButtonFaceColor()
  FloodFillArea Picture1, lButtonFaceColor
End Sub

Private Sub Form_Load()
Dim i As Integer
  MLSLoadLanguage Me '<- Add by Multi-Languages Support Add-in
  AzzeraCampi ' preparo tutti i campi
  
  For i = lblAddress.LBound To lblAddress.UBound
    lblAddress(i).BackColor = vbButtonFace ' RGB(245, 244, 239)
  Next i
  
  
End Sub


Private Sub txtIP_GotFocus(Index As Integer)
  OnFocus txtIP(Index), True
End Sub

Private Sub txtIP_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)

      Select Case KeyCode
        Case vbKeyBack
          Rem Cancello l'ultimo numero
          If txtIP(Index).SelLength > 0 Then
            Rem Se sono selezionate più cifre le deseleziono
            txtIP(Index).SelLength = 0
            txtIP(Index).SelStart = Len(txtIP(Index).Text)
          End If
          
        Case vbKeyLeft
          If txtIP(Index).SelStart = 0 Then
            If Index > 0 Then
              If txtIP(Index).SelLength > 0 Then
                'If txtIP(Index).SelStart = Len(txtIP(Index).Text) Then
                  txtIP(Index).SelLength = 0
                'End If
              Else
                SendKeys "+{TAB}"
              End If
            End If
          End If
        
        Case vbKeyRight
          If txtIP(Index).SelStart = Len(txtIP(Index).Text) Then
            SendKeys "{TAB}"
          End If
      End Select
End Sub

Private Sub txtIP_KeyPress(Index As Integer, KeyAscii As Integer)
  
  Rem Accetta solo numeri da 0 a 9, ed il punto "."
  KeyAscii = ValidateNumberChar(KeyAscii)
  
  If KeyAscii = vbKeyReturn Then
    Rem elimino il beep
    KeyAscii = 0
    Exit Sub
  End If

  If KeyAscii = vbKeyBack Then
    If txtIP(Index).SelStart = 0 Then
      Rem Se il cursore si trova all'estrema sinistra
      Rem premendo Back mi sposto al campo precedente
      SendKeys "+{TAB}"
    End If
    Exit Sub
  End If
  
  
  Rem Permetto il punto "." per passare al campo successivo
  If KeyAscii = 46 Then
    KeyAscii = 0
  End If
  
End Sub



'---------------------------------------------------------------------------------------
' Procedure   : VerificaCampi
' DateTime    : 14/06/2005 13.45
' Author      : Giorgio Brausi (vbcorner@vbcorner.net - http://www.vbcorner.net)
' Purpose     : Verifica che non vi siano campi vuoti
' Return value: Restituisce   -1 se OK,
'                             -2 se manca il nome
'                             oppure l'<indice> del txtIP di cui manca il dato
'
'---------------------------------------------------------------------------------------
Public Function VerificaCampi() As Long
  Dim i As Integer
  
  VerificaCampi = -1
  
  If Len(Trim(txtProfileName.Text)) = 0 Then
      VerificaCampi = -2
      Exit Function
  End If
  
  Rem Verifico tutti i campi, escluso il DNS alternativo
  For i = 0 To 15
    If Len(Trim(txtIP(i))) = 0 Then
      VerificaCampi = i
      Exit Function
    End If
  Next
  
End Function

Private Sub txtIP_KeyUp(Index As Integer, KeyCode As Integer, Shift As Integer)
  
  Select Case KeyCode
    Rem Quando premo Enter passa al controllo successivo
    Case vbKeySeparator, vbKeyReturn, vbKeyDecimal, 190
      KeyCode = 0
      SendKeys "{TAB}"
          
    Case 48 To 57, 96 To 105 ' se ho digitato un numero
      If Len(txtIP(Index).Text) = 3 Then
        Rem se il campo contiene 3 numeri passo al campo successivo
        SendKeys "{TAB}"
      End If
      
    Case Else
      
'      Select Case KeyCode
'        Case vbKeyLeft
'          If txtIP(Index).SelStart = 0 Then
'            If Index > 0 Then
'              SendKeys "+{TAB}"
'            End If
'          End If
'
'        Case vbKeyRight
'          If txtIP(Index).SelStart = Len(txtIP(Index).Text) Then
'            SendKeys "{TAB}"
'          End If
'      End Select
      
  End Select

End Sub

Private Sub txtIP_LostFocus(Index As Integer)

  OnFocus txtIP(Index), False
  
  Rem Se il campo è vuoto posso anche permettere lo spostamento,
  Rem tanto alla fine ci pensa la routine VerificaCampi a controllare.
  If txtIP(Index).Text = "" Then Exit Sub

  Rem Imposta automaticamente il Subnet Mask sulla base dell'indirizzo IP
  Rem Modificato da: Doretto Roberto (roberto.doretto@volvo.com)
  Select Case Index
    Case 3 ' Verifica che l'indirizzo IP, non sia un indirizzo riservato
           ' Tenendo comunque buono 0 (zero) come IP
                
        If Int(txtIP(0).Text) = 127 Or Int(txtIP(0).Text) > 223 Then
            txtIP(0).SetFocus
            Exit Sub
        End If
        'If Int("0" & txtIP(4).Text) = 0 Then ???
            Select Case Int(txtIP(0).Text)
                Rem Classe Indirizzi IP tipo  "A"
                'Case Is >= 1 And Int(txtIP(0).Text) <= 126 ???
                Case 1 To 126
                    txtIP(4).Text = "255"
                    txtIP(5).Text = "0"
                    txtIP(6).Text = "0"
                    txtIP(7).Text = "0"
                    
                Rem Classe Indirizzi IP tipo  "B"
                'Case Is >= 128 And Int(txtIP(0).Text) <= 191 ???
                Case 128 To 191
                    txtIP(4).Text = "255"
                    txtIP(5).Text = "255"
                    txtIP(6).Text = "0"
                    txtIP(7).Text = "0"
                Rem Classe Indirizzi IP tipo  "C"
                'Case Is >= 192 And Int(txtIP(0).Text) <= 223 ???
                Case 192 To 223
                    txtIP(4).Text = "255"
                    txtIP(5).Text = "255"
                    txtIP(6).Text = "255"
                    txtIP(7).Text = "0"
            End Select
        'End If
  End Select
  
End Sub


Private Sub txtIP_Validate(Index As Integer, Cancel As Boolean)
  Rem Accetto campi vuoti?
'  If Len(Trim(txtIP(Index))) = 0 Then
'    MsgBox "Inserire un valore!", vbExclamation
'    Cancel = True
'  End If

  Rem Oppure se è vuoto inserisco automaticamente uno 0
'  If Len(Trim(txtIP(Index))) = 0 Then
'    txtIP(Index) = 0
'  End If
  
End Sub

Private Sub txtProfileName_GotFocus()
  OnFocus txtProfileName, True
End Sub


Private Sub txtProfileName_KeyPress(KeyAscii As Integer)
  Rem elimino il beep
  If KeyAscii = vbKeyReturn Then
    KeyAscii = 0
  End If
  
End Sub

Private Sub txtProfileName_KeyUp(KeyCode As Integer, Shift As Integer)
  Rem Quando premo Enter passa al controllo seguente
  If KeyCode = vbKeyReturn Then
    KeyCode = 0
    SendKeys "{TAB}"
  End If

End Sub

Private Sub txtProfileName_LostFocus()
  OnFocus txtProfileName, False
End Sub


